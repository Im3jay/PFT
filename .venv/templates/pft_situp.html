
<!DOCTYPE html>
<html>
<head>
     <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='proctor.css') }}">
    <title>Proctor Access</title>
</head>
<body>
    <div class="page-topnav">
        <a href="#home"> <!-- to lobby -->
            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT5VD0nTIINJKFvxpOP-Fc_HSz0a_6A4PlkANlCwiQ4Ew&s" class="logo_2" style="width: 60px; height: auto;">
        </a>
        <a class="page-font">51st Engineer Brigade, Philippine Army</a>
    </div>
    {% if 'proctor_access' in session %}
    <p>Logged in as {{ session['proctor_access']['name'] }}</p>
    {% endif %}
    <form action="/pft_situp_record" method="post">
        Serial Number: <input type="text" name="afpsn" id="afpsn_id" onkeyup="suggestUsernames()" on><br>
        <div id="usernameDisplay"></div><br>
        
        <!-- Push-up data -->
        Situp Count: <input type="text" name="raw_situp" id="rawSitup_id" disabled><br>
        
        <!-- Date -->
        Date: <input type="date" name="act_date" id="actDate_id" disabled><br><br>
        
        <!-- Participant Number -->
        Participant Number: <input type="text" name="participant_number" id="participantNumber" disabled><br><br>
        
        <input type="submit" value="Submit" id="submitButton" disabled>
    </form>

    <script>
        function suggestUsernames() {
            var afpsn_id = document.getElementById("afpsn_id").value;
    
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    document.getElementById("usernameDisplay").innerHTML = this.responseText;
                }
            };
            xhttp.open("GET", "/suggest_usernames?afpsn=" + afpsn_id, true);
            xhttp.send();
        }
    
        function fillSerialNumber(username) {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    document.getElementById("afpsn_id").value = this.responseText;
                    searchSerialNumber()
                }
            };
            xhttp.open("GET", "/get_serial_number?username=" + username, true);
            xhttp.send();
  
        }
    
        function searchSerialNumber() {
            var afpsn_id = document.getElementById("afpsn_id").value;

            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    var userData = JSON.parse(this.responseText);
                    var displayHTML = '';
                    if (userData) {
                        displayHTML += 'Full Name: ' + userData.full_name + '<br>';
                        displayHTML += 'AFPOS MOS: ' + userData.afpos_mos + '<br>';
                        displayHTML += 'AFPSN: ' + userData.afpsn + '<br>';
                        displayHTML += 'Rank: ' + userData.rank + '<br>';

                        // Check if data exists for today's date in pft_situp table
                        checkExistingSitupData(userData.afpsn);
                    } else {
                        displayHTML = 'No user found.';
                        // Clear input fields and disable them
                        clearAndDisableInputs();
                    }
                    document.getElementById("usernameDisplay").innerHTML = displayHTML;
                }
            };
            xhttp.open("GET", "/search_serial?afpsn=" + afpsn_id, true);
            xhttp.send();
        }

        function checkExistingSitupData(afpsn) {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    var existingData = JSON.parse(this.responseText);
                    if (existingData) {
                        // Data exists, lock the text boxes
                        lockTextBoxes();
                    } else {
                        // Data doesn't exist, enable the text boxes
                        enableTextBoxes();
                    }
                }
            };
            xhttp.open("GET", "/check_existing_situp_data?afpsn=" + afpsn, true);
            xhttp.send();
        }

        function lockTextBoxes() {
            document.getElementById("rawSitup_id").disabled = true;
            document.getElementById("actDate_id").disabled = true;
            document.getElementById("participantNumber").disabled = true;
            document.getElementById("submitButton").disabled = true;
        }

        function enableTextBoxes() {
            document.getElementById("rawSitup_id").disabled = false;
            document.getElementById("actDate_id").disabled = false;
            document.getElementById("participantNumber").disabled = false;
            document.getElementById("submitButton").disabled = false;
        }

        function clearAndDisableInputs() {
            document.getElementById("rawSitup_id").value = "";
            document.getElementById("actDate_id").value = "";
            document.getElementById("participantNumber").value = "";
            document.getElementById("rawSitup_id").disabled = true;
            document.getElementById("actDate_id").disabled = true;
            document.getElementById("participantNumber").disabled = true;
            document.getElementById("submitButton").disabled = true;
        }
    </script>
</body>
</html>
