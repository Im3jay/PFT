<!DOCTYPE html>
<html>
<head>
     <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='proctor.css') }}">
    <title>Proctor Access</title>
</head>
<body>
    <div class="page-topnav">
        <a href="#home"> <!-- to lobby -->
            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT5VD0nTIINJKFvxpOP-Fc_HSz0a_6A4PlkANlCwiQ4Ew&s" class="logo_2" style="width: 60px; height: auto;">
        </a>
        <a class="page-font">51st Engineer Brigade, Philippine Army</a>
    </div>
    {% if 'proctor_access' in session %}
    <p>Logged in as {{ session['proctor_access']['name'] }}</p>
    {% endif %}
    <form action="/pft_kmrun_record" method="post">
        Serial Number: <input type="text" name="afpsn" id="afpsn_id" onkeyup=suggestUsernames() on><br>
        <div id="usernameDisplay"></div><br>
        
        
        <!-- Sit-up data -->
        kmrun Count: <input type="text" name="rawKmrun" id="rawKmrun_id" disabled><br>
        
        <!-- Date -->
        Date: <input type="date" name="act_date" id="actDate_id" disabled><br><br>
        
        <!-- Participant Number -->
        Participant Number: <input type="text" name="participant_number" id="participantNumber" disabled><br><br>
        
        <input type="submit" value="Submit" id="submitButton" disabled>
    </form>

    <script>
        function suggestUsernames() {
            var afpsn_id = document.getElementById("afpsn_id").value;
    
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    document.getElementById("usernameDisplay").innerHTML = this.responseText;
                }
            };
            xhttp.open("GET", "/suggest_usernames?afpsn=" + afpsn_id, true);
            xhttp.send();
        }
    
        function fillSerialNumber(username) {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    document.getElementById("afpsn_id").value = this.responseText;
                    searchSerialNumber()
                }
            };
            xhttp.open("GET", "/get_serial_number?username=" + username, true);
            xhttp.send();
  
        }
    
        function searchSerialNumber() {
    var afpsn_id = document.getElementById("afpsn_id").value;

    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            var userData = JSON.parse(this.responseText);
            var displayHTML = '';
            if (userData) {
                displayHTML += 'Full Name: ' + userData.full_name + '<br>';
                displayHTML += 'AFPOS MOS: ' + userData.afpos_mos + '<br>';
                displayHTML += 'AFPSN: ' + userData.afpsn + '<br>';
                displayHTML += 'Rank: ' + userData.rank + '<br>';
            } else {
                displayHTML = 'No user found.';
            }
            document.getElementById("usernameDisplay").innerHTML = displayHTML;

            // Enable input fields if valid afpsn
            if (userData) {
                document.getElementById("rawKmrun_id").disabled = false;
                document.getElementById("actDate_id").disabled = false;
                document.getElementById("participantNumber").disabled = false;
                document.getElementById("submitButton").disabled = false;
                checkExistingData();
            }
            
            else {
                // Clear input fields and disable them if not valid afpsn
                document.getElementById("rawKmrun_id").value = "";
                document.getElementById("actDate_id").value = "";
                document.getElementById("participantNumber").value = "";
                document.getElementById("rawKmrun_id").disabled = true;
                document.getElementById("actDate_id").disabled = true;
                document.getElementById("participantNumber").disabled = true;
                document.getElementById("submitButton").disabled = true;
            }
        }
    };
    xhttp.open("GET", "/search_serial?afpsn=" + afpsn_id, true);
    xhttp.send();
}

        

        function submitKmRun() {
            // Submit kmrun count
            document.getElementById("dataForm").action = "/submit_kmrun";
            document.getElementById("dataForm").submit();
        }
    </script>
    
</body>
</html>
